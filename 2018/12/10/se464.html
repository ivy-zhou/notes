<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>SE 464 - Sentences</title>

<meta name="description" content="Professor Werner Dietl, Fall 2018I attended almost no lectures for this course, so notes are organized by slides. These notes turned out to be way more detai...">
<link rel="canonical" href="/notes/2018/12/10/se464.html"><link rel="alternate" type="application/rss+xml" title="Sentences" href="/notes/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/notes/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/notes/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/notes/assets/favicon-16x16.png"><link rel="manifest" href="/notes/assets/site.webmanifest"><link rel="mask-icon" href="/notes/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/notes/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/notes/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet -->
<link rel="stylesheet" href="/notes/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/notes/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"
 preserveAspectRatio="xMidYMid meet">
<metadata>
Created by potrace 1.11, written by Peter Selinger 2001-2013
</metadata>
<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M219 5026 c-52 -18 -91 -60 -104 -113 -16 -62 -8 -179 19 -288 14
-56 21 -78 38 -129 11 -32 21 -63 22 -70 2 -6 15 -38 30 -71 16 -33 29 -66 29
-72 0 -7 4 -13 9 -13 4 0 8 -9 8 -20 0 -11 3 -20 8 -20 4 0 18 -21 32 -47 13
-27 27 -50 30 -53 4 -3 9 -12 13 -20 9 -19 28 -48 49 -74 9 -12 32 -41 51 -65
l35 -44 -64 -65 c-35 -36 -66 -73 -69 -84 -4 -10 -10 -18 -14 -18 -9 0 -71
-97 -71 -111 0 -5 -5 -9 -11 -9 -5 0 -8 -4 -4 -9 3 -5 1 -12 -5 -16 -20 -12
-113 -229 -103 -239 4 -3 2 -6 -4 -6 -9 0 -17 -24 -27 -80 -1 -3 -5 -10 -9
-16 -3 -7 -9 -29 -13 -50 -3 -22 -9 -46 -14 -54 -4 -8 -10 -31 -14 -50 -3 -19
-8 -46 -11 -60 -3 -13 -7 -42 -10 -65 -3 -22 -8 -47 -10 -55 -2 -8 -7 -46 -11
-85 -3 -38 -8 -73 -10 -76 -2 -4 -7 -86 -10 -182 l-7 -175 44 5 c24 2 52 5 62
6 9 1 17 4 17 7 0 4 6 7 13 7 11 1 24 3 95 19 15 4 34 8 42 9 8 1 22 5 31 9 8
4 29 8 45 9 16 1 35 8 42 15 7 6 22 12 31 12 10 0 36 6 57 13 22 8 52 17 67
21 26 6 28 5 27 -21 -1 -15 -1 -32 0 -38 1 -5 1 -44 0 -85 -1 -41 -2 -92 -3
-112 0 -21 2 -40 4 -43 3 -2 2 -28 -1 -57 -5 -46 -13 -60 -53 -103 -66 -69
-68 -72 -120 -146 -26 -37 -47 -71 -47 -77 0 -6 -4 -12 -8 -14 -8 -3 -95 -173
-93 -183 1 -3 -6 -19 -14 -35 -9 -17 -13 -30 -10 -30 3 0 -1 -13 -10 -30 -8
-16 -15 -32 -15 -35 0 -3 0 -6 -1 -7 0 -2 -2 -11 -5 -20 -4 -19 -6 -27 -18
-69 -4 -14 -9 -41 -11 -60 -2 -19 -4 -34 -5 -34 -1 0 -4 -16 -6 -35 -7 -54
-10 -320 -4 -320 3 0 5 -17 4 -38 0 -20 2 -41 5 -47 6 -11 10 -28 13 -62 1
-13 5 -23 9 -23 3 0 6 -7 6 -15 0 -20 25 -98 35 -110 4 -5 8 -17 8 -27 0 -10
4 -18 9 -18 5 0 11 -10 15 -22 3 -13 16 -39 28 -58 12 -19 22 -37 23 -40 1
-14 67 -93 130 -156 65 -65 151 -134 200 -160 39 -20 70 -39 75 -45 3 -3 47
-22 99 -43 131 -53 278 -94 401 -111 25 -4 65 -10 90 -13 59 -9 2448 -9 2521
0 143 17 319 57 419 95 8 3 20 7 25 8 6 2 42 17 80 35 39 18 73 32 78 32 4 -1
7 2 7 7 0 5 10 13 23 16 12 4 32 17 45 28 12 11 22 16 22 11 0 -5 4 -4 8 2 4
5 25 23 47 39 55 39 207 195 225 231 8 16 18 31 22 34 10 8 63 114 60 123 -1
4 3 7 8 7 5 0 9 3 8 8 -2 7 21 80 31 97 3 6 6 15 8 20 5 24 13 62 17 83 3 12
8 27 11 32 3 6 1 10 -6 10 -8 0 -8 4 1 15 14 17 19 268 7 360 -11 88 -18 130
-24 145 -3 8 -6 18 -5 22 1 4 -8 35 -19 70 -12 35 -21 69 -22 76 0 6 -4 12 -9
12 -4 0 -7 3 -6 7 3 17 -15 63 -25 63 -6 0 -8 3 -4 6 8 8 -77 167 -131 244
-59 83 -58 81 -119 147 l-52 56 1 203 0 202 82 -25 c44 -13 88 -27 96 -30 17
-7 173 -47 225 -57 6 -1 19 -5 30 -9 11 -3 37 -8 57 -11 21 -3 41 -6 45 -7 30
-5 32 3 28 114 -4 108 -12 226 -20 291 -13 110 -17 142 -20 146 -2 3 -6 26
-10 50 -15 108 -85 360 -107 384 -4 6 -8 18 -8 28 0 10 -7 30 -16 43 -9 14
-12 25 -8 25 5 0 5 4 -1 8 -5 4 -26 39 -45 77 -53 108 -140 230 -207 291 -13
12 -23 23 -23 26 0 3 20 27 45 54 24 27 45 52 45 55 0 3 14 24 30 45 53 66
191 329 204 389 2 6 14 48 29 95 14 47 29 97 32 113 3 15 7 38 10 52 3 13 7
60 9 103 6 112 -20 174 -85 207 -51 27 -77 25 -181 -11 -10 -4 -18 -10 -18
-15 0 -5 -4 -9 -10 -9 -13 0 -48 -30 -124 -102 -33 -32 -60 -58 -60 -58 -1 0
-42 -39 -91 -88 -50 -48 -110 -103 -134 -122 -24 -19 -48 -40 -55 -45 -21 -19
-92 -63 -144 -89 l-52 -26 -26 22 c-15 13 -40 35 -56 51 -17 15 -34 27 -39 27
-4 0 -19 10 -33 23 -31 29 -181 114 -255 145 -92 38 -205 74 -281 88 -14 2
-31 7 -38 9 -40 14 -248 19 -832 18 -597 -1 -715 -4 -790 -19 -14 -3 -34 -6
-45 -8 -11 -2 -27 -6 -35 -10 -8 -3 -26 -7 -40 -10 -64 -10 -290 -100 -330
-131 -8 -6 -35 -23 -60 -37 -25 -14 -80 -53 -122 -87 -43 -34 -84 -61 -92 -61
-18 0 -120 58 -124 71 -2 5 -8 9 -13 9 -9 0 -29 15 -74 55 -13 11 -36 31 -51
44 -38 31 -163 151 -159 151 4 0 -29 31 -145 138 -25 23 -50 42 -57 42 -6 0
-13 4 -15 9 -1 5 -10 11 -18 13 -8 2 -21 9 -28 16 -7 6 -23 12 -35 13 -12 0
-29 2 -38 4 -8 1 -31 -3 -50 -9z"/>
</g>
</svg>
<a title="A loosely organized collection of notes and thoughts
" href="/notes/">Sentences</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/notes/archive.html">Archive</a></li><li class="navigation__item"><a href="/notes/about.html">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>SE 464</h1></header><span class="split-space">&nbsp;</span>
          <a class="edit-on-github"
            title="Edit on Github"
            href="https://github.com/ivy-zhou/notes/tree/master/_posts/2018-12-10-se464/2018-12-10-se464.md">
            <i class="far fa-edit"></i></a></div><meta itemprop="headline" content="SE 464"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/notes/archive.html?tag=uwaterloo">uwaterloo</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/notes/archive.html?tag=notes">notes</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Dec 10, 2018</span>
            </li></ul></div><meta itemprop="author" content="Ivy Zhou"/><meta itemprop="datePublished" content="2018-12-10T00:00:00+00:00">
    <meta itemprop="keywords" content="uwaterloo,notes"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><blockquote>
  <p>Professor Werner Dietl, Fall 2018</p>
</blockquote>

<p class="warning">I attended almost no lectures for this course, so notes are organized by slides. These notes turned out to be way more detailed than necessary.</p>

<h1 id="intro">Intro</h1>

<p><strong>software architecture:</strong> set of principal design decisions about the system, blueprint for software construction and evolution. It has 3 aspects: structure/behaviour/interaction of system, communication, non-functional requirements.</p>

<p>Non-functional requirements define the behaviour of a system (e.g. system should be fast and secure). Functional requirements define what a system is supposed to do (e.g. system should book me Fedbus tickets).</p>

<p>We want <em>practical</em> ways to <em>guarantee</em> that software is correct. The different ways that we can do this fall on a spectrum.</p>

<p><img src="img1.png" alt="img1" /></p>

<p>Ways to achieve practical guarantees on software quality</p>

<p>In the top right corners we have specialized type systems like Android’s SPARTA (Static Program Analysis for Reliable Trusted Apps) which guarantee no leakage of private information.</p>

<p>Something with high practicality but low guarantees would be crowd-sourced verification.</p>

<p>Another approach is MUSE (Mining and Understanding Software Enclaves). This program mines specifications from a code base continuously, automates finding/repairing program errors, and synthesizes new programs from the existing codebase using mined specifications. It’s composed of open source software projects.</p>

<h1 id="architecture">Architecture</h1>

<p>We choose a design based on the following factors (among others):</p>

<ul>
  <li>fitness for purpose,</li>
  <li>cost of production (parts, labour, capital/tools)</li>
  <li>cost of operation</li>
  <li>fitness for future</li>
</ul>

<p>Steps of the design process:</p>

<ol>
  <li>Ideation</li>
  <li>Analysis: determine and apply criteria</li>
  <li>Selection of design</li>
  <li>Elaboration/Refinement</li>
  <li>Iteration</li>
</ol>

<p><em>Radical components</em> are components that haven’t been invented yet. <em>Radical configurations</em> are designs that haven’t been tried yet. As designers, we want to take radical problems (problems solvable with radical configurations/designs) and solve them with existing/standard/normal solutions.</p>

<p>All of architecture involves design, but not all of design involves architecture (i.e. art).</p>

<p>The same system can have multiple architectures i.e. logical web architecture (class diagrams) vs. physical web architecture (server map) vs. dynamic web architecture (realtime map of requests sent/received).</p>

<p>Stakeholders in a system’s architecture include: architects, developers, testers, managers, customers, users, and vendors. These people define the goals of the system and then make principal architecture decisions that achieve those goals.</p>

<p><strong>prescriptive architecture:</strong> design decisions made prior to the system’s construction, as-intended design</p>

<p><strong>descriptive architecture:</strong> describes how the system has been built, as-implemented architecture</p>

<p><strong>architectural evolution:</strong> when a system needs to be changed. Ideally we would go back to modify a system’s prescriptive architecture (i.e. change the overall design of the system to fit). In practice, the descriptive architecture (the system) is directly modified. This happens because of: developer sloppiness, short deadlines, lack of documented prescriptive architecture, need/desire for code optimizations, inadequate techniques or tool support.</p>

<p><strong>architectural degradation:</strong> introduction of principal design decisions into a system that <em>don’t</em> violate the original prescriptive architecture</p>

<p><strong>architectural erosion:</strong> introduction of architectural design decisions into a system that <em>do</em> violate the original prescriptive architecture</p>

<p><strong>architectural recovery:</strong> process of determining a system’s architecture from its implementation artifacts e.g. source code, executable files, bytecode. Used to recover architecture from architectural degradation/erosion.</p>

<p>A software architecture should be a composition of multiple interacting elements. There are 3 types of elements: processing, data/state, interaction.</p>

<p><strong>components:</strong> software elements that encapsulate processing and data. They perform data hiding, have an interface, and have explicitly defined dependencies e.g. a software class. They provide application services.</p>

<p><strong>connectors:</strong> regulates interactions among components e.g. procedure call connectors, shared memory connectors, message passing connectors, streaming connectors, distribution connectors, wrapper/adapter connectors. They provide application specific interaction.</p>

<p><strong>configuration:</strong> topology of components and connectors in a system’s architecture</p>

<p>The <em>deployment view</em> of an architecture is the description of how that architecture has been physically placed on hardware. We can assess it through its available memory, power consumption, required network bandwidth etc.</p>

<p>Building software is hard because:</p>

<ul>
  <li>It’s a young field</li>
  <li>There are high user expectations</li>
  <li>Software relies on software relies on hardware</li>
  <li>Complexity increases non-linearly with program size</li>
  <li>Conformity, system state depends on its environment</li>
  <li>Changeability, software is too easily modified</li>
  <li>Intangibility, follows no laws</li>
</ul>

<p>Ways we can make it less hard:</p>

<ul>
  <li>High level languages</li>
  <li>Development tools and environments</li>
  <li>Component based reuse</li>
  <li>Development strategies
    <ul>
      <li>Incremental, iterative method</li>
      <li>Waterfall: requirements to design to implementation to verification to maintenance</li>
      <li>Evolutionary prototyping: build robust prototype and refine it so that users can have access to it before final system is created</li>
      <li>The spiral model, which examines the risks of a project and picks another development strategy that best fits the risk</li>
    </ul>
  </li>
  <li>Emphasis on designing software before we implement it</li>
</ul>

<h1 id="views-and-non-functional-properties">Views and Non-functional Properties</h1>

<p>Recall that architecture composes components and connectors. From a topological standpoint, we want to:</p>

<ul>
  <li>minimize coupling (information hide between components)</li>
  <li>maximize cohesion within each component (each component is one logical service)</li>
</ul>

<p><strong>abstraction:</strong> remove unnecessary detail. You can abstract away control (e.g. do-while loop) and you can abstract away data types e.g interfaces.</p>

<p><strong>decomposition:</strong> top-down abstraction where we break problem into independent components and we describe each component</p>

<p><strong>architectural representations:</strong> technical communication about a system between stakeholders, has properties: ambiguity, accuracy, and precision</p>

<ul>
  <li>
    <p>Reading Assignment: 4 + 1 View Model</p>

    <p><a href="https://www.cs.ubc.ca/~gregor/teaching/papers/4+1view-architecture.pdf"></a></p>

    <p>A system has a logical view (object model), a development view (classes), a process view (runtime, concurrency), and a physical view (maps software onto hardware). Each is appropriate for some stakeholder and scenario.</p>
  </li>
</ul>

<p><strong>architectural model:</strong> an artifact documenting some or all of the architectural design decisions about a system</p>

<p><strong>architecture visualization:</strong> way of depicting some or all of the architectural design decisions about a system to a stakeholder</p>

<p><strong>architecture view:</strong> subset of related architectural design decisions</p>

<p><strong>component diagram:</strong> captures components and static relationships between components</p>

<p><strong>sequence diagram:</strong> captures behaviour of system for a specific runtime scenario</p>

<p><strong>deployment diagram:</strong> mapping between components and physical devices</p>

<p><strong>statechart diagram:</strong> formal description of system behaviour through states, doesn’t map well to components</p>

<p><img src="img2.png" alt="img2" /></p>

<p>Classifications of non-functional properties</p>

<p><strong>non-functional property (NFP):</strong> constraint on the way a system is implemented or delivers its functionality e.g. efficiency, scalability, evolvability, complexity, heterogenity, dependability</p>

<p>A system has to be designed for functional properties (FPs) to be correct and designed for NFPs to be usable. Each stakeholder has their own opinion on what NFPs matter most e.g. QA interested in testability more than sales, developers interested more about maintainability than customer.</p>

<p>Challenges to ensuring NFPs:</p>

<ul>
  <li>Some are only partially understood by other stakeholders</li>
  <li>They can be qualitative rather than quantitative</li>
  <li>They frequently depend on many variables</li>
  <li>Non-technical pressures e.g. time-to-market of functional features</li>
</ul>

<h4 id="design-guidelines-for-ensuring-nfps">Design Guidelines for Ensuring NFPs</h4>

<table>
  <thead>
    <tr>
      <th>Guideline</th>
      <th>Components</th>
      <th>Connectors</th>
      <th>Topology</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Efficiency: system’s ability to meet performance requirements</td>
      <td>- Keep them small<br />- Simple and compact interfaces<br />- Allow multiple interfaces to the same functionality <br />- Separate data from processing compoents <br />- Separate data from metadata</td>
      <td>- Carefully select connectors <br />- Be careful of broadcast connectors <br />- Encourage async interaction <br />- Be wary of location/distribution transparency</td>
      <td>- Keep frequent collaborators close (e.g. in memory) <br />- Consider efficiency impact of selected style</td>
    </tr>
    <tr>
      <td>Complexity: the size of a system, its volume of constituent elements, their internal structure, and their interdependencies</td>
      <td>- Separate concerns <br />- Isolate functionality from interaction <br />- Ensure cohesiveness <br />- Insulate processing from data format changes</td>
      <td>- Isolate interaction from functionality <br />- Restrict interactions provided by each connector</td>
      <td>- Eliminate unnecessary dependencies <br />- Use hierarchical decomposition</td>
    </tr>
    <tr>
      <td>Scalability: capability of system to meet new size/scope requirements</td>
      <td>- Keep components focused <br />- Simplify interfaces <br />- Avoid unnecessary heterogeneity <br />- Distribute data sources <br />- Replicate data</td>
      <td>- Use explicit connectors <br />- Use simplest connectors</td>
      <td>- Avoid bottlenecks<br /> - Place data close to consumer <br />- Location transparency</td>
    </tr>
    <tr>
      <td>Heterogeneity: ability of system to be compose of or execute in disparate parts</td>
      <td>- Same as scalability</td>
      <td>- Same as scalability</td>
      <td>- Same as scalability</td>
    </tr>
    <tr>
      <td>Portability: ability of system to execute on multiple platforms while retaining FPs and NFPs of original</td>
      <td>- Same as scalability</td>
      <td>- Same as scalability</td>
      <td>- Same as scalability</td>
    </tr>
    <tr>
      <td>Evolvability: ability to change to satisfy new requirements and environments</td>
      <td>- Same as for complexity <br />- Isolate modifications to reduce risks</td>
      <td>- Clearly define responsibilities <br />- Make connectors flexible</td>
      <td>- Avoid implicit connectors<br /> - Encourage location transparency</td>
    </tr>
    <tr>
      <td>Dependability: ability of a system to respond to failures (from environment, components, connectors) to failures at runtime</td>
      <td>- Control external component dependencies <br />- Support reflection<br /> - Support exception handling</td>
      <td>- Use explicit connectors <br />- Provide interaction guarantees</td>
      <td>- Avoid single points of failure <br />- Enable back ups <br />- Support system health monitoring <br />- Support dynamic adaptation</td>
    </tr>
    <tr>
      <td>Survivability: ability to resist, recover and adapt to threats (i.e. prevent future threats)</td>
      <td>- Same as dependability</td>
      <td>- Same as dependability</td>
      <td>- Same as dependability</td>
    </tr>
    <tr>
      <td>Safety: ability to avoid failures that will cause loss of life, injury, or loss of property</td>
      <td>- Same as dependability</td>
      <td>- Same as dependability</td>
      <td>- Same as dependability</td>
    </tr>
  </tbody>
</table>

<h1 id="architectural-styles">Architectural Styles</h1>

<p>We can classify ways to design software in terms of the scope of that design and the amount of domain specific knowledge that that design uses.</p>

<p><img src="img3.png" alt="img3" /></p>

<p><strong>Reading Assignment:</strong> <a href="https://www.oreilly.com/ideas/contrasting-architecture-patterns-with-design-patterns">Contrasting architecture patterns with design patterns</a></p>

<p>Architecture design differs from design patterns in that:</p>

<ul>
  <li>
    <p>They talk about overall components rather than classes e.g. in layered architecture pattern, we talk about the presentation layer and the business layer rather than a Button class</p>
  </li>
  <li>
    <p>Design patterns only talk about one type of entity e.g. a Builder class, whereas architectural patterns can talk about many components e.g. in microkernel architecture, the core system component and the plugin component</p>
    <ul>
      <li>Architectural patterns have many variants and hybrids. For example, event driven architectures has a mediator variant (events passed through central mediator) and a broker variant (forwards requests).</li>
      <li>Architectural patterns operate at a higher level of abstraction, are scaffolding frameworks</li>
    </ul>
  </li>
</ul>

<p><strong>Reading Assignment:</strong> <a href="https://www.sigops.org/s/conferences/sosp/2009/papers/klein-sosp09.pdf">seL4: Formal Verification of an OS</a></p>

<p>seL4 is an OS microkernel design which was formally verified in C to satisfy its spec (i.e. terminate, execution safety, access control) through machine assisted proof techniques. This was done by prototyping the kernel in a subset of Haskell which can be translated into the language used by the theorem prover Isabelle/HOL. The prototype of the kernel can be run in a virtual environment to aid debugging. Then, a C implementation of the Haskell prototype is created for better model memory management within the OS and provide low level performance benefits.</p>

<p>The kernel is modeled within the theorem prover as a series of layers (abstract layer describing what the kernel does, executable specification layer, and the C implementation layer).</p>

<h1 id="architectural-patterns"><strong>Architectural Patterns</strong></h1>

<p><strong>architectural pattern:</strong> set of architectrual design decisions that are applicable to a recurring design problem and parameterized to account for different contexts in which that problem appears</p>

<h2 id="three-tiered-pattern"><strong>Three Tiered Pattern</strong></h2>

<p>Front tier: contains user interface functionality</p>

<p>Middle tier: contains application’s major functionality</p>

<p>Back tier: contains application’s data access and storage functionality</p>

<h2 id="mvc"><strong>MVC</strong></h2>

<p>3 components</p>

<ul>
  <li>Model for core functionality and data</li>
  <li>Views for displaying information to user</li>
  <li>Controllers for handling user input</li>
</ul>

<p><img src="img4.png" alt="img4" /></p>

<h2 id="sense-compute-control">Sense-Compute-Control</h2>

<p><img src="img5.png" alt="img5" /></p>

<h2 id="design-recovery">Design Recovery</h2>

<p>To do design recovery, we can either do syntactic clustering or semantic clustering.</p>

<h3 id="syntactic-clustering">Syntactic Clustering</h3>

<p>Static code analysis done without running the program. We can identify coupling and cohesion from descriptions of components, but we may miss some purely dynamic relationships e.g. exception handling.</p>

<h3 id="semantic-clustering">Semantic Clustering</h3>

<p>Use domain knowledge about the application and behavioural similarity of its entities to infer their meaning. We can verify that these inferred meanings are correct through executing the system on a representative set of inputs. This is tough to automate.</p>

<h3 id="greenfield-design">Greenfield Design</h3>

<p>Sometimes, we just start over from scratch to find out what the architecture of the system should be without looking that much at the existing source code. To do this, we can look for analogies for the system in real life, brainstorm, search existing literature, create morphological charts (list all necessary functions and possible implementations) etc.</p>

<h1 id="architectural-styles-1">Architectural Styles</h1>

<p><strong>architectural styles:</strong> collection of architectural design decisions for a system that constrain further decisions about that system. It can be implemented with some subset of architectural patterns, and it will have its own design vocabulary in terms of custom components and connectors.</p>

<p>We use them because:</p>

<ul>
  <li>Design/code reuse</li>
  <li>Understandability of system through standardization (known invariants)</li>
  <li>Interoperability</li>
  <li>Style specific analyses are already known (advantages/disadvantages)</li>
  <li>Ways to visualize are already known</li>
</ul>

<p>Properties of good architecture:</p>

<ul>
  <li>Results in a consistent set of principled decisions</li>
  <li>Resilient to change</li>
  <li>Source of guidance through product lifetime</li>
  <li>Reuses established engineering knowledge</li>
</ul>

<p>We rarely use only one unmodified (pure) architectural style in a system.</p>

<p><img src="img6.png" alt="img6" /></p>

<h2 id="layered-style">Layered Style</h2>

<p>Has a hierarchical system organization, each layer acts as a server for layers above and a client for layers below. Connectors are thought of as protocols of layer interaction.</p>

<p>For instance, in a virtual machine, client software runs on an opaque layer of virtualized hardware.</p>

<p><img src="img7.png" alt="img7" /></p>

<p>Layered architectural style</p>

<p>Advantages:</p>

<ul>
  <li>Abstraction increases up the layers</li>
  <li>Evolvability</li>
  <li>Changes in a layer affect at most the adjacent two layers, so aids reuse</li>
  <li>Low coupling since a layer only interacts with layers above and below it</li>
  <li>Standardized layer interfaces</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>Not universally applicable</li>
  <li>Performance (may force high level layers to be coupled with lower ones)</li>
</ul>

<h3 id="client-server-style">Client-Server Style</h3>

<p>Layered architecture with only 2 layers, a client layer and a server layer. Servers don’t know the number of identity of clients, but clients know their server’s identity. Connectors are remote procedure calls on the network according to some protocol.</p>

<p>Advantages:</p>

<ul>
  <li>Abstraction between servers and clients (servers don’t care about the state of the client)</li>
  <li>Redundancy in that new connections can easily be set up</li>
  <li>One change to a server can affect all of its clients (evolvability)</li>
  <li>Standardized protocol between servers and clients</li>
  <li>Ease in scaling</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>Performance (server can become bottleneck)</li>
  <li>Easy point of attack at server</li>
</ul>

<h2 id="data-flow-styles">Data Flow Styles</h2>

<h3 id="batch-sequential">Batch Sequential</h3>

<p>Separate programs executed in order, data is passed as an aggregate from one to the next. The connectors between programs is the physical process of loading the next program in (no concurrency, non-interactive). These systems are still used in transaction processing.</p>

<h3 id="pipe-and-filter-style">Pipe and Filter Style</h3>

<p>Components are filters which do some transformation on their input stream and produce an output stream. Connectors are the pipes which allow the streams to travel from filter to filter. Each filter has no knowledge of other filters or their state. Examples include the unix shell (ls to grep), distributed systems, signal processing, compilers, and parallel programming.</p>

<p>3 variations on pipe and filter: bounded pipe (only allow a certain amount of data), pipelines (only linear), and typed pipes (only allow data of a certain type).</p>

<p><img src="img8.png" alt="img8" /></p>

<p>We might think of the pipe and filter style as a layered architecture turned sideways.</p>

<p>Advantages:</p>

<ul>
  <li>Simple composition</li>
  <li>Reuse</li>
  <li>Prototyping</li>
  <li>Easy growth and evolution (evaluating for bottlenecks is easy)</li>
  <li>Filters can be easily re-implemented without affecting the rest of the system</li>
  <li>Concurrency and parallelism</li>
</ul>

<p>Disadvantages</p>

<ul>
  <li>Poor performance: each filter has to parse data, sharing global data is difficult</li>
  <li>Not appropriate for interaction</li>
  <li>Low fault tolerance threshold (e.g. what happens when a filter crashes)</li>
  <li>Data transformation to stream to accomodate filters</li>
  <li>Increases complexity and computation</li>
</ul>

<h2 id="shared-memory">Shared Memory</h2>

<h3 id="blackboard">Blackboard</h3>

<p>A central data structure (the blackboard) holds all state and controls the whole system. Components then operate on the blackboard. Connections are either active, as in incoming streams of transactions on a database, or passive as in changes on a blackboard trigger other processes. Examples of this include AI systems, integrated software environments, and compiler architecture (imagine stack).</p>

<p>Advantages:</p>

<ul>
  <li>Efficient when dealing with large amounts of data</li>
  <li>Clients are loosely coupled</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>Data model is static, bounded by defined schema, resistant to change since many clients depend on it</li>
  <li>Difficult to distribute</li>
</ul>

<p><img src="img9.png" alt="img9" /></p>

<h3 id="rule-based-style">Rule-based style</h3>

<p>An inference engine parses user input and determines whether it’s a fact/rule or a query. If it’s fact/rule, it adds it into its knowledge base. If it’s a query, it looks for relevant rules to produce an fact for the query. This approach has many applications in artificial intelligence, since the rules approximate how humans think.</p>

<p>Thus, we can easily change the system by changing its rules. When there’s a large number of rules, they may conflict in the fact that they produce based on the facts/query given.</p>

<p>Advantages:</p>

<ul>
  <li>Can easily build very flexible evolvable systems by changing rules</li>
  <li>Systems can be very lightweight and scalable</li>
  <li>We can use formal logic to verify coverage of rules</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>It’s hard to come up with rules, we may run into conflicts</li>
</ul>

<h2 id="interpreter">Interpreter</h2>

<h3 id="interpreter-style">Interpreter style</h3>

<p>Dynamically add to the set of commands possible in the system, good for end user programmability. Examples of this are LISP and Scheme. Suitable for applications in which the most appropriate language or machine for executing the solution is not directly available. Components are an interpretation engine, memory, and state. Connectors are procedure calls and direct memory access. Examples include programming language compilers and scripting languages.</p>

<p><img src="img10.png" alt="img10" /></p>

<p>Advantages:</p>

<ul>
  <li>High evolvability due to ability to add new capabailities dynamically</li>
  <li>Simulation of non-implemented parts</li>
  <li>Portability</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>Can be slow due to computational complexity</li>
</ul>

<h2 id="implicit-invocation">Implicit Invocation</h2>

<p>Method calls are explicit invocations. Triggering a registered listener’s handler with an event is an implicit invocation. Event broadcasters don’t know anything about the event consumers, the effects of the events, or the ordering of the events.</p>

<h3 id="publish-subscribe-style">Publish-subscribe style</h3>

<p>Components register for events, which are then published by different sources or by a centralized system e.g. news, fire alarms, MVC, IDEs, database systems, user interfaces</p>

<p><img src="img11.png" alt="img11" /></p>

<h3 id="event-based-style">Event based style</h3>

<p><img src="img12.png" alt="img12" /></p>

<p>Advantages:</p>

<ul>
  <li>Scalable, new listeners can just register themselves</li>
  <li>Minimal dependency and loose coupling, components can be added/removed, components don’t directly interact with each other</li>
  <li>Highly reusable, can easily reimplement without chaining interface</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>Loss of execution control</li>
  <li>Data exchange has to be in terms of events, which has a hit on performance</li>
  <li>Hard to debug, as contracts between components are not formalized and any event can set off a chain of side effects</li>
</ul>

<h2 id="peer-to-peer-style">Peer-to-Peer Style</h2>

<p>State and behaviour are distributed among peers which can act as either clients or servers. Each peer is a component with their own state. Connectors consist of network protocols and data elements are network messages. Skype used to have this sort of architecture.</p>

<p>Advantages:</p>

<ul>
  <li>Hard to attack, since there’s no central server</li>
  <li>Arguably more secure/performant communication, again since no central server is involved</li>
</ul>

<p>Disadvantages:</p>

<ul>
  <li>Client machines are often much less reliable than a central server</li>
</ul>

<p><strong>Common Object Request Broker Arhcitecture (CORBA):</strong> allows for communication between systems deployed on different OS’s, programming languages, and hardware</p>

<p>CORBA places a different <strong>distributed object</strong> on each platform they’re trying to support. These objects can share data and invoke methods on other objects through a well-defined API. In CORBA, the components are the distributed objects, the connectors are the RPC invocations, and the data elements are the arguments to methods, return values, and exceptions.</p>

<p>If architectures use differing architectural styles, they’ll differ greatly. If they have the same architectural style, they can still be different variations.</p>

<h1 id="architectural-styles-2">Architectural Styles 2</h1>

<p><strong>Reading Assignment:</strong> <a href="http://aosabook.org/en/eclipse.html">The Architecture of Open Source Applications: Eclipse</a></p>

<p>Eclipse was first organized as a lot of plugins.</p>

<p><strong>Reading Assignment:</strong> <a href="http://aosabook.org/en/llvm.html">LLVM</a></p>

<p>Compiler architecture is generally organized as 3 phase design: a frontend for AST building, an optimizer, and a backend for machine code generation. These 3 sections are rarely separated cleanly due to implementation e.g. in GCC, the backend walks the frontend AST for debugging info, the frontend generate backend data strcutures, and global data structures are used throughout.</p>

<p>LLVM uses an intermediate representation (IR) which is a step above machine code. Front end produces IR, the optimizer optimizes IR into better IR through multiple passes, and the backend converts IR to machine code in multiple passes. We can configure which passes are done for a specific compilation case e.g. not many registers available.</p>

<p>The backend uses target description <code class="language-plaintext highlighter-rouge">.td</code> files to describe specific properties about the target being compiled to e.g. a list of all 16 32-bit registers available. We can augment this information with C++ code specific to the architecture e.g. for handling x87 floating point stack.</p>

<p>LLVM IR can be (de)serialized into a binary format called LLVM bitcode. Serializing to bitcode at an intermediate step rather than creating object code right away allows us to delay code generation to link time or even install time to get better optimizations.</p>

<p>LLVM IR is much easier to unit test because you can load LLVM IR specific to the piece of the compiler that is broken, rather than create a <code class="language-plaintext highlighter-rouge">.c</code> file which runs through the whole compiler in an effort to test one crashing optimizer. To find which optimizer is offending, you can use the LLVM BugPoint tool which reduces a list of crashing optimizers and input to a minimum test case.</p>

<h4 id="question">Question</h4>

<p>Consider a development environment capable of integrating a set of tools (e.g., compiler, editor, debugger, etc.) produced by different vendors. What is the architectural style most appropriate for the system? Give a sketch of the system and explain the interaction between parts of the architecture. Give one advantage and one disadvantage of the given choice.</p>

<h5 id="answer">Answer</h5>

<p>The architectural style most suitable would be the layered virtual machine architectural style. The editor and the debugger would both be layers on top of the compiler layer, and would use the compiler as a blackbox on top of which they can call functions. One advantage of this is that it is a very decoupled design, which is advantageous since there are multiple vendors. One disadvantage may be the performance, which can be impacted as we get higher and higher level tools.</p>

<h1 id="architectural-modeling">Architectural Modeling</h1>

<p><strong>architectural model:</strong> artifact that captures the documented design decisions in a system’s architecture</p>

<p><strong>architectural modelling notation:</strong> language/means used by an architectural model</p>

<p>Stakeholders in the system have to determine what should be modelled, at what level of detail, and with how much rigor. They should do a cost-benefit analysis on what to model.</p>

<p>Things we can model:</p>

<ul>
  <li>Basic architectural elements
    <ul>
      <li>Components</li>
      <li>Connectors</li>
      <li>Interfaces</li>
      <li>Configurations</li>
      <li>Rationale (reason behind decisions)</li>
    </ul>
  </li>
  <li>Elements of architectural style
    <ul>
      <li>Specific basic architectural elements relevant to the style</li>
      <li>Component, connector, interface types</li>
      <li>Constraints on interactions, behavioural constraints, concurrency constraints</li>
    </ul>
  </li>
  <li>Static and Dynamic aspects
    <ul>
      <li>Static aspects of a system don’t change as the system runs e.g. logical topologies, deployment map</li>
      <li>Dynamic aspects of the system change as the system runs e.g. state of individual componetns or connectors, state of a data flow through the system</li>
    </ul>
  </li>
  <li>Functional and non-functional aspects of a system</li>
</ul>

<p><strong>view:</strong> subset of a architectural model according to a <em>viewpoint</em>, which is a set of criteria that restrict the design decisions captured in the view e.g. logical, physical, deployment, concurrency, behavioural</p>

<p>We use several views from different viewpoints to capture a single model, because using one large view would be infeasible and impractical.</p>

<p>Views can contain overlapping and related design decisions. If decisions presented by one view conflict with those of another view, those two views are inconsistent. Otherwise, they’re consistent.</p>

<p>Types of inconsistencies:</p>

<ul>
  <li>direct inconsistencies e.g. the system runs on 2 hosts vs. the system runs on 3 hosts</li>
  <li>refinement inconsistencies, meaning the high level and the low level views of the same parts of a system conflict</li>
</ul>

<p>We should consider a model’s ambiguity, accuracy, and precision.</p>

<ul>
  <li>static (topology) or dynamic (behaviour) aspects inconsistencies, e.g. different description of system behaviour in 2 different views, different topologies described in 2 different views</li>
  <li>functional or non-functional inconsistencies</li>
</ul>

<p>Sometimes, inconsistencies are OK, but most of the the time, it means there’s some problem with your system.</p>

<p>To evaluate a modelling approach, consider:</p>

<ul>
  <li>Scope and purpose, what is modelled (or not modelled) by the approach?</li>
  <li>Basic elements of the model</li>
  <li>Style, how well the model fits with the underlying architectural style</li>
  <li>Static/dynamic aspects</li>
  <li>Dynamic modelling, how the model change as the system changes</li>
  <li>Non-functional aspects</li>
  <li>Ambiguity</li>
  <li>Accuracy</li>
  <li>Precision</li>
  <li>Viewpoints</li>
  <li>Viewpoint consistency</li>
</ul>

<p>Approaches to modelling:</p>

<ul>
  <li>Generic approaches e.g. natural language, powerpoint, UML</li>
  <li>Early architecture description languages e.g. Darwin, Rapide, Wright</li>
  <li>Domain/style specific languages e.g. Koala, Weave, AADL</li>
  <li>Extensible architecture description languages e.g. Acme, ADML, xADL</li>
</ul>

<p><strong>Unified Modelling Language (UML):</strong> widespread notations for modelling static and dynamic aspects of systems</p>

<p>Static aspect views in UML:</p>

<ul>
  <li>
    <p>Component diagrams</p>

    <p><img src="img13.png" alt="img13" /></p>
  </li>
  <li>
    <p>Deployment diagrams</p>

    <p><img src="img14.png" alt="img14" /></p>
  </li>
  <li>
    <p>Class diagrams</p>

    <p><img src="img15.png" alt="img15" /></p>
  </li>
</ul>

<p>Dynamic aspect views in UML:</p>

<ul>
  <li>
    <p>Sequence diagrams</p>

    <p><img src="img16.png" alt="img16" /></p>
  </li>
  <li>
    <p>Use case diagrams</p>

    <p><img src="img17.png" alt="img17" /></p>
  </li>
  <li>
    <p>State machine diagrams</p>

    <p><img src="img18.png" alt="img18" /></p>
  </li>
</ul>

<p>Advangtages of UML:</p>

<ul>
  <li>Support for many viewpoints relevant to software engineering</li>
  <li>Ubiquity improves comprehensibility, extensive documentation and tool support</li>
</ul>

<p>Disadvantages of UML:</p>

<ul>
  <li>Very ambiguous if not enough detail is given</li>
  <li>Difficult to assess consistency between views</li>
  <li>Difficult to capture new concepts or views</li>
</ul>

<h1 id="security-and-chrome">Security and Chrome</h1>

<p><strong>security:</strong> maintaining integrity (only authorized modifications), availability (accessible by authorized parties), and confidentiality (prevent access/knowledge from unauthorized parties) of system resources (hardware, software, firmware, data, communications etc.)</p>

<p>Design principles for security:</p>

<ul>
  <li>Least privilege: give each component only the privileges it requires</li>
  <li>Fail-safe defaults: deny access if explicit permission is absent</li>
  <li>Economy of mechanism: adopt simple security mechanisms</li>
  <li>Complete mediation: ensure every access is permitted</li>
  <li>Open design: do not rely on secrecy for security</li>
  <li>Separation of privilege: introduce multiple parties with differing privileges</li>
  <li>Least common mechanism: limit critical resource sharing to only a few mechanisms</li>
  <li>Psychological acceptability: make security mechanisms usable</li>
  <li>Defense in depth: have multiple layers of countermeasures</li>
</ul>

<h2 id="architectural-access-control-models">Architectural Access Control Models</h2>

<p><strong>discretionary access control:</strong> allow access to a resource based on the resource, the identity of the requestor, and whether the requestor has permission</p>

<p><img src="img19.png" alt="img19" /></p>

<p><strong>mandatory access control:</strong> define policies for resource access, i.e. users have classification hierarchy which correspond to resource classification hierarchy</p>

<p><img src="img20.png" alt="img20" /></p>

<p>Types of attacks:</p>

<ul>
  <li>Impersonation of an authorized user</li>
  <li>Fradulent actions e.g. seller does not ship items bought</li>
  <li>Misrepresentation, delegitimize an authorized user</li>
  <li>Collusion, delegitimize an authorized user as a part of group</li>
  <li>Addition of users who have no information on other users in the system, where existing users on the system also don’t know about them</li>
</ul>

<p><strong>trust:</strong> the probability that an agent A asseses that another agent B will perform a particular action  in a context where it affects A i.e. A trusts B to do X in matters Y affecting A</p>

<p><strong>reputation:</strong> expectation about entity’s future behaviour based on its past behaviour</p>

<h4 id="chrome-architecture">Chrome architecture</h4>

<p><strong>Reading assignment:</strong> <a href="https://queue.acm.org/detail.cfm?id=1556050">Browser security in Chrome</a></p>

<p><strong>Reading assignment:</strong> <a href="http://seclab.stanford.edu/websec/chromium/chromium-security-architecture.pdf">Security architecture of the Chromium Browser</a></p>

<p>Chrome deals with accesses of insecure online content that can compromise:</p>

<ul>
  <li>confidentiality: leak user data</li>
  <li>integrity: read/write arbitrary data on disk</li>
  <li>availability: crash Chrome application or OS</li>
</ul>

<p>Chrome relies on least privilege, separation of privilege, and defence in depth. They sandbox to reduce severity of vulnerabilities, auto-update to reduce window of vulnerability, and warn about malicious sites before accessing them to reduce frequency of exposure to attacks.</p>

<p><img src="img21.png" alt="img21" /></p>

<h1 id="design-introduction">Design Introduction</h1>

<p>Analysis models an existing system to deal with its functional challenges, while design creates a model to implement a new system to deal with its implementation challenges. The design of a system maps responsibilities to objects.</p>

<p>Design process loop:</p>

<ol>
  <li>Build</li>
  <li>Measure</li>
  <li>Learn</li>
</ol>

<p>We want to reuse designs in order to use previous experience and promote: abstraction, flexibility, modularity, and elegance.</p>

<p>We have to consider dynamic behaviour as well static relationships from examining just the code. As we increase abstraction, we have less control over the behaviour of the system.</p>

<h2 id="design-principles"><strong>Design Principles</strong></h2>

<p>Don’t be STUPID, be SOLID.</p>

<p>STUPID:</p>

<ul>
  <li>Singleton</li>
  <li>Tight coupling</li>
  <li>Untestable</li>
  <li>Premature Optimization</li>
  <li>Indescriptive naming</li>
  <li>Duplicates</li>
</ul>

<p>SOLID</p>

<ul>
  <li>Single reponsibility prinicple</li>
  <li>Open/closed principle: classes should be open for extension but closed to modification</li>
  <li>Liskov Substitution Principle: subtypes should behave as their parent types</li>
  <li>Interface Segregation: only place key methods in interfaces</li>
  <li>Dependency Inversion Principle: higher level modules should not depend on lower level modules</li>
</ul>

<p>Lower level principles:</p>

<ul>
  <li>Encapsulate what varies</li>
  <li>Program to abstractions not implementations</li>
  <li>Favour composition over inheritance (enables runtime behaviour changes and makes code easier to evolve in the future)</li>
  <li>Strive for loose coupling</li>
</ul>

<p>Quality attributes:</p>

<ul>
  <li>
    <p>Simplicity: Don’t Repeat Yourself (DRY), Keep it Simple, Stupid (KISS)</p>
  </li>
  <li>
    <p>Cohesion</p>

    <p><img src="img22.png" alt="img22" /></p>
  </li>
  <li>
    <p>Coupling</p>

    <p><img src="img23.png" alt="img23" /></p>
  </li>
  <li>
    <p>There is incoherency in an operation if it has too many “and” clauses (temporal cohesion, logical cohesion), and if it has too many “if…then…else” clauses (control coupling, coincidental cohesion, logical cohesion).</p>
  </li>
</ul>

<p><strong>Cognitive dimensions:</strong></p>

<ul>
  <li>premature commitment: decision made with insufficient data that constrains future choices</li>
  <li>hidden dependencies</li>
  <li>secondary notation: non-obvious relationships may be meaningful or provide context</li>
  <li>viscosity: reistance to change</li>
</ul>

<p>We want design patterns for the same reasons as we wanted architectural styles:</p>

<ul>
  <li>Ease communication with a shared vocabulary</li>
  <li>Leverage existing design knowledge</li>
  <li>Enhance flexibility for future change</li>
  <li>Increase reusability of developed code</li>
</ul>

<p><strong>design patterns:</strong> common solutions to recurring design problems (will have tradeoffs). They describe a class/object with well defined dependencies, structures, interactions, and convensions. They’re language independent and can be considered micro-architectures.</p>

<h1 id="design-patterns">Design Patterns</h1>

<p><strong>double dispatch:</strong> decide which version of a method implemented to call at runtime i.e. in visitor pattern when calling the visit method on either a root node or a leaf node</p>

<h2 id="creational-patterns">Creational Patterns</h2>

<p><strong>creational patterns:</strong> ways to encapsulate construction logic for and defer class instantiation until runtime</p>

<h3 id="singleton-pattern">Singleton Pattern</h3>

<p>Use when you need global access to a single instance of something</p>

<p>Example: Everyone needs to access the official government.</p>

<p><img src="img24.png" alt="img24" /></p>

<p>Pros:</p>

<ul>
  <li>Guarantees class only has single instance</li>
  <li>Global access point to instance</li>
  <li>Singleton has lazy instantiation</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Violates SRP</li>
  <li>Masks bad design e.g. high coupling</li>
  <li>Hard to implement in multithreaded environment</li>
  <li>Difficult to mock Singleton for unit tests since constructor is private</li>
</ul>

<h3 id="factory-pattern">Factory Pattern</h3>

<p>Create different kinds of an AbstractProduct using an Factory implemented by ConcreteFactory classes</p>

<p>Example: Create Ships and Trucks as Transport.</p>

<p><img src="img25.png" alt="img25" /></p>

<p>Pros:</p>

<ul>
  <li>Avoid tight coupling between client of Factory and ConcreteProducts</li>
  <li>SRP, product creation code in one one place</li>
  <li>Open/closed, easy introduction of new Products into the code</li>
</ul>

<p>Cons:</p>

<ul>
  <li>More complicated due to addition of classes</li>
</ul>

<h3 id="abstract-factory">Abstract Factory</h3>

<p>Introduce AbstractFactory over 2 or more existing ConcreteFactories that are each capable of producing a related family of ConcreteProduct classes. The client then configures the AbstractFactory to use the right ConcreteFactory and only deals with the Product interfaces.</p>

<p>Example: Create IKEA chairs, desks, lamps or Victorian chairs, desks, lamps.</p>

<p><img src="img26.png" alt="img26" /></p>

<p>Pros:</p>

<ul>
  <li>Products from a Factory are guaranteed to be related</li>
  <li>Avoids tight coupling between concrete products and client</li>
  <li>SRP, product creation code all in one place</li>
  <li>Open/Closed Principle, easy addition of new families of Products</li>
</ul>

<p>Cons:</p>

<ul>
  <li>More complicated due to addition of classes</li>
</ul>

<h3 id="builder-pattern">Builder Pattern</h3>

<p>Build different kinds of a complex object using configuration methods on an Builder implemented by ConcreteBuilder classes. Optionally, use a Director to wrap what kind of Builder you’re using.</p>

<p>Example: Building a house, you need to configure whether the house has a garden, garage, swimming pool, whether it’s made of wood/stone etc.</p>

<p><img src="img27.png" alt="img27" /></p>

<p>Pros:</p>

<ul>
  <li>Construct objects step by step</li>
  <li>Reuse construction code when constructing different objects</li>
  <li>SRP, object creation code all in one place</li>
</ul>

<p>Cons:</p>

<ul>
  <li>More complicated due to addition of classes</li>
</ul>

<h3 id="prototype-pattern">Prototype Pattern</h3>

<p>If you need a copy of an object, make the object copy itself, since it will have access to its own private members.</p>

<p>Example: Copy Rectangle and Circle subclasses of Shape, but only interact with Shape code by forcing Shape to have a <code class="language-plaintext highlighter-rouge">clone</code> method.</p>

<p><img src="img28.png" alt="img28" /></p>

<p>Pros:</p>

<ul>
  <li>Avoids tight coupling between client code and ConcretePrototype classes</li>
  <li>Can remove repeated/complex initialization code when copying</li>
  <li>Alternative to inheritance when dealing with configuration presets for prototypes</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Cloning complex objects that have circular references is tricky</li>
</ul>

<h2 id="structural-patterns">Structural Patterns</h2>

<p><strong>structural patterns:</strong> ways to make the relationships between entities more flexible</p>

<h3 id="adapter">Adapter</h3>

<p>Create a wrapper around the methods of one or more classes to make it compatible with a client specified interface.</p>

<p>Example: You need an adapter for a wall socket in Europe in order to use your chargers built for US sockets.</p>

<p>If the Adapter has Adaptees, it’s an Object Adaptor. If the Adapter is an Adaptee, it’s a Class Adaptor.</p>

<p><img src="img29.png" alt="img29" /></p>

<p>Pros:</p>

<ul>
  <li>SRP, since interface conversion code is separate</li>
  <li>Open/Closed, since new adapters can be introduced without breaking existing code</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Complexity increases due to more classes</li>
</ul>

<h3 id="bridge-pattern">Bridge Pattern</h3>

<p>Create interfaces for each separate characteristic a class can have i.e. Color for a Shape, and then make that class own one or more of their characteristic classes.</p>

<p>Example: Different remotes kinds can be for different devices. Create a Device interface which a Remote has 1 or more of.</p>

<p><img src="img30.png" alt="img30" /></p>

<p>Pros:</p>

<ul>
  <li>Client code works with abstraction over class characteristics</li>
  <li>Open/closed, can introduce new classes or new characteristics</li>
  <li>SRP, focus on implementation in characteristic classes</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Makes code more complicated when abstraction and implementation are closely related</li>
</ul>

<h3 id="decorator-pattern">Decorator Pattern</h3>

<p>Wrap classes in other classes which own them and provide more functionality</p>

<p>Example: Russian nesting doll where each layer is constructed by passing in another layer or the core of the doll.</p>

<p><img src="img31.png" alt="img31" /></p>

<p>Pros:</p>

<ul>
  <li>Extend object’s behavior without making a subclass</li>
  <li>Add or remove capabilities at runtime</li>
  <li>Combine several behaviors by wrapping an object in multiple decorators</li>
  <li>SRP, divide large class into many smaller decorators</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Hard to remove specific wrapper from decorator stack</li>
  <li>Hard to implement a decorator where behavior doesn’t change based on order in which decorators stack</li>
  <li>Initial configuration code for layers is ugly</li>
</ul>

<h3 id="facade">Facade</h3>

<p>Provide an interface over many disparate classes like Adaptor, but it doesn’t kill its classes at the end</p>

<p>Example: Wedding planner needs to coordinate bakery, florist, caterer etc.</p>

<p><img src="img32.png" alt="img32" /></p>

<p>Pros:</p>

<ul>
  <li>Isolates code from complexity of subsystem</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Facade becomes God Object coupled to all classes</li>
</ul>

<h3 id="proxy">Proxy</h3>

<p>Wrap access to a real object for performance reasons</p>

<p>Example: Write a proxy over a video downloading service that acts like the video downloading service but only downloads the video when it doesn’t have it cached.</p>

<p><img src="img33.png" alt="img33" /></p>

<p>Pros:</p>

<ul>
  <li>Control service object without clients knowing about it</li>
  <li>Manage lifecycle of the service object</li>
  <li>Proxy works even if service object isn’t ready</li>
  <li>Open/closed, can introduce new proxies without changing service</li>
</ul>

<p>Cons:</p>

<ul>
  <li>More complicated due to extra classes</li>
  <li>Delay in service response</li>
</ul>

<h3 id="composite">Composite</h3>

<p>Use for tree structures</p>

<p>Example: File system with folders and files</p>

<p><img src="img34.png" alt="img34" /></p>

<p>Pros:</p>

<ul>
  <li>Can work with tree structures</li>
  <li>Open/closed, can introduce new component types</li>
</ul>

<p>Cons:</p>

<ul>
  <li>May be tough to have common interface for differing components</li>
</ul>

<h3 id="flyweight">Flyweight</h3>

<p>If you have a lot of objects with the same unchanging internal state, you can create a Flyweight class encapsulating that state which all the objects can then share. You can also create a Factory that dispenses a particular Flyweight you need for an object. This saves on memory. In the diagram, the object you’re creating a lot of is the Context.</p>

<p>Example: Creating a ton of instances of a Particle class, each with their own color, coordinates, and speed is a lot of duplicated individual data. Instead, make Particles share a reference to a Flyweight Particle, which consists of data they keep constant e.g. all bullets have the same color.</p>

<p><img src="img35.png" alt="img35" /></p>

<p>Pros:</p>

<ul>
  <li>Saves memory</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Code is complicated because state of Flyweight object is separated out into Context and Flyweight</li>
</ul>

<h2 id="behavioral-patterns">Behavioral Patterns</h2>

<p><strong>behavioral patterns:</strong> identify common communication patterns between objects and make them more flexible</p>

<h3 id="visitor-pattern">Visitor Pattern</h3>

<p>Because elements visited can be polymorphic (i.e. we have to call different visit methods on them), we do a double dispatch, meaning we make the accept method on each element call the correct visit implementation on the Visitor object it is passed.</p>

<p>Example: Insurance guy visits different buildings, each of accepts the visitor and then asks them for a kind of insurance specific to that building</p>

<p><img src="img36.png" alt="img36" /></p>

<p>Pros:</p>

<ul>
  <li>Open/Closed, can introduce new components/visitors</li>
  <li>SRP, can move multiple versions of the same behavior into the same class</li>
</ul>

<p>Cons:</p>

<ul>
  <li>Need to update all visitors each time a class gets added or removed from the component hierarchy</li>
  <li>Visitors might not have access to members of components they visit</li>
</ul>

<h3 id="observer-pattern">Observer Pattern</h3>

<p>Publishers and subscribers</p>

<p><img src="img37.png" alt="img37" /></p>

<h3 id="interpreter-pattern">Interpreter Pattern</h3>

<p><img src="img38.png" alt="img38" /></p>

<p>Implement a specialized computer language to rapidly solve a specific set of problems</p>

<h3 id="template-method-pattern">Template Method Pattern</h3>

<p>Describes the program skeleton of a program</p>

<p><img src="img39.png" alt="img39" /></p>

<h1 id="code-smells">Code Smells</h1>

<p><strong>code smells:</strong> indications in source code that there is a design problem e.g.</p>

<ul>
  <li>Large classes and methods</li>
  <li>Deep nesting of control</li>
  <li>Duplicate code</li>
  <li>Casts to implementation classes</li>
  <li>Static state</li>
  <li>No information hiding, bad encapsulation</li>
  <li>Many parameters</li>
</ul>

<p><strong>refactoring:</strong> restructuring existing code to improve abstraction, code reuse, cohesion, coupling, naming, usage of design patterns etc. Good test coverage ensures restructured code still has the same external behavior.</p>

<h2 id="mvc-1">MVC</h2>

<p>Smalltalk was one of the first languages used to implement MVC. It’s used in Java UI frameworks, enterprise Java beans (EJB), in Google Web Toolkit (GWT, a Java library that compiles to Javascript web applications), and in .NET programming (software framework for programming applications on Windows).</p>

<p><strong>model:</strong> contains application data, subjects in the observer pattern that don’t know anything about views (have only an abstract reference to views)</p>

<p><strong>view:</strong> presents model to user, receives events from the user to manipulate data but doesn’t store data, can be configured by the user to show different data</p>

<p><strong>controller:</strong> updates model when view receives user event, view is tightly coupled with controller</p>

<p><img src="img40.png" alt="img40" /></p>

<h3 id="interaction-mechanism">Interaction mechanism:</h3>

<ol>
  <li>User interacts with View</li>
  <li>View notifies Controller, which processes event and calls the Model as needed</li>
  <li>If the Model changes, it notifies its observers, the Views</li>
</ol>

<h3 id="benefits">Benefits</h3>

<ul>
  <li>Decouple models and views
    <ul>
      <li>Supports multiple views</li>
      <li>Maintainability (easy to add new views to the same model)</li>
      <li>Split teams (UI can be developed separately from business logic)</li>
    </ul>
  </li>
  <li>Testability (UI can be tested separate from business logic)</li>
</ul>

<h3 id="cons">Cons</h3>

<ul>
  <li>Complexity (use of abstractions and events)</li>
  <li>Efficiency (large models, frequent updates)</li>
</ul>

<p><strong>compound pattern:</strong> pattern that relies on several other design patterns</p>

<p>MVC is a compound pattern because:</p>

<ul>
  <li>View and Controller use Strategy Pattern</li>
  <li>View and Model use the Observer Pattern</li>
  <li>View is often a Composite pattern</li>
</ul>

<h2 id="model-view-presenter-mvp">Model View Presenter (MVP)</h2>

<p>MVP further separates the View from the Model by moving the code that handles Model updates from the View to the Controller, and then calling the Controller the Presenter.</p>

<p><strong>model:</strong> same as in MVC, often fires events to an event bus</p>

<p><strong>view:</strong> same as in MVC, but never receives update events from the Model or tries to get data from model objects (only interacts with primitives) e.g. <code class="language-plaintext highlighter-rouge">setUser(String)</code> instead of <code class="language-plaintext highlighter-rouge">setUser(User)</code></p>

<p><strong>presenter:</strong> updates the view when the model changes, updates the model when view receives user event</p>

<p><img src="img41.png" alt="img41" /></p>

<h3 id="benefits-1">Benefits</h3>

<ul>
  <li>The same as MVC, with better:
    <ul>
      <li>Ability to split teams (UI can be better separated)</li>
      <li>Testability (UI can be better tested alone)</li>
      <li>Less complexity due to fewer events</li>
    </ul>
  </li>
</ul>

<h3 id="cons-1">Cons</h3>

<ul>
  <li>The same as MVC, but less complexity</li>
</ul>

<h2 id="model-view-view-model-mvvm">Model View View-Model (MVVM)</h2>

<p>MVVM was built specifically for the WPF and Silverlight environments on the .NET platforms.</p>

<p>Introduces a ViewModel that tracks relevant changes to model for a specific View (i.e. data binding between model and view model). The ViewModel also extends the Model for Views. Like in MVC, there can be multiple Views for the same ViewModel.</p>

<p><img src="img42.png" alt="img42" /></p>

<p>MVP Topology (left) vs. MVVM topology (right)</p>

<h4 id="question-1">Question</h4>

<p>Design a simple account creation feature. Draw class diagrams and write pseudocode. Compare MVC and MVP.</p>

<p>Data: user name, password, country, language</p>

<h5 id="answer-1">Answer</h5>

<p>MVC:</p>

<p><img src="img43.png" alt="img43" /></p>

<p>MVP:</p>

<p><img src="img44.png" alt="img44" /></p>

<h1 id="dependency-injection">Dependency Injection</h1>

<h2 id="dependency-inversion-d-from-solid">Dependency Inversion (D from SOLID)</h2>

<ul>
  <li>High level modules should not depend on low level modules, both should depend on abstractions</li>
  <li>Minimizes direct coupling between concrete classes</li>
  <li>Program to interfaces not to implementations!</li>
</ul>

<p>But, even if we use abstractions between objects, at object creation we will have to specify a concrete class (e.g. <code class="language-plaintext highlighter-rouge">Foo f = new ConcreteFoo();</code>). Furthermore, if we want to use a different concrete class implementation as a dependency, we have to recompile the code.</p>

<p>Dependency injection:</p>

<ul>
  <li>Takes a set of components (classes and interfaces)</li>
  <li>Adds a set of configuration metadata</li>
  <li>Provides the metadata to an injection framework</li>
  <li>Bootstraps object creation with a configured injector</li>
</ul>

<p>Dependency injection is <strong>inversion of control (IoC)</strong>, because the library doing dependency injection calls into the application code, instead of the application code calling a library as usual.</p>

<p>Other examples of IoC:</p>

<ul>
  <li>Factory pattern</li>
  <li>Service loader pattern</li>
  <li>Template method design pattern</li>
  <li>Strategy design pattern</li>
</ul>

<h4 id="example">Example</h4>

<p>A BillingService relies on an Order and a CreditCard.</p>

<p>Google Guice (IoC framework) configures which abstract classes get bound to which concrete classes through the use of a module.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Automatically instantiates the objects as needed</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BillingModule</span> <span class="kd">extends</span> <span class="nc">AbstractModule</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">bind</span><span class="o">(</span><span class="nc">TransactionLog</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="nc">DatabaseTransactionLog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">bind</span><span class="o">(</span><span class="nc">CreditCardProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="nc">CheapCreditCardProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">bind</span><span class="o">(</span><span class="nc">BillingSerivce</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="nc">RealBillingService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">@Inject</code> tells Guice to instantiate the correct concrete class based on the configuration of the module.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RealBillingService</span> <span class="kd">implements</span> <span class="nc">BillingSerivce</span> <span class="o">{</span>
	<span class="c1">// Interact with abstractions</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">CreditCardProcessor</span> <span class="n">processor</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">TransactionLog</span> <span class="n">transactionLog</span><span class="o">;</span>
	
	<span class="nd">@Inject</span>
	<span class="kd">public</span> <span class="nf">RealBillingService</span><span class="o">(</span><span class="nc">CreditCardProcessor</span> <span class="n">processor</span><span class="o">,</span> 
														<span class="nc">TransactionLog</span> <span class="n">transactionLog</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">processor</span> <span class="o">=</span> <span class="n">processor</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">transactionLog</span> <span class="o">=</span> <span class="n">transactionLog</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Then, application code simply needs to instantiate the injector.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="nc">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span><span class="k">new</span> <span class="nc">BillingModule</span><span class="o">());</span>
	<span class="nc">BillingService</span> <span class="n">billingSerivce</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">BillingService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Dependency inversion is not the same as abstraction! Consider the following class.</p>

<p><img src="img45.png" alt="img45" /></p>

<p>In this case, changing Bar can require in changing IBar and thus in changing Foo. But Foo should not be dependent on Bar since it is a higher level module! Thus, we have abstraction but not dependency inversion.</p>

<p>We can solve this issue by having Foo define IBar. Now, Bar depends on Foo instead of Foo depending on Bar through the wrapper IBar. Now, if Foo changes, then IBar may change and thus Bar may need to change. Thus we have dependency inversion.</p>

<p><img src="img46.png" alt="img46" /></p>

<p>Now, Foo can be placed in its own package independent of Bar.</p>

<h1 id="cloudweb-services">Cloud/Web Services</h1>

<h3 id="cloud-precursors">Cloud Precursors</h3>

<p><strong>grid computing:</strong> using a combination of computing resources from multiple administrative domains, forms a “super computer”</p>

<p><strong>utility computing:</strong> billing model where service provider offers set computing resources e.g. computation, storage, and services, charged by usage</p>

<h2 id="cloud-computing">Cloud Computing</h2>

<p><strong>cloud computing:</strong> model for enabling on-demand  network access to a shared pool of configurable computing resources that can be rapidly provisioned and released (i.e. can scale up or down, unlike utility computing), promotes availability</p>

<p>Important characteristics of cloud computing, as defined by National Institute of Standards and Technology (NIST):</p>

<ul>
  <li>On-demand self service: consumers get computing capabilities without human interaction</li>
  <li>Broad network access: capabilities are available over the network</li>
  <li>Resource pooling: computing resources are pooled to serve multiple consumers, location independence (performance/security)</li>
  <li>Rapid elasticity: resources easily added and removed</li>
  <li>Measured service: metering of storage, processing, bandwidth etc.</li>
</ul>

<h3 id="benefits-2">Benefits</h3>

<ul>
  <li>Agility, quick to respond to changes</li>
  <li>Scalability, resources can be added for peak load</li>
  <li>Cost, resources can be released, multi-tenancy</li>
  <li>Reliability, different sites, computation centers controlled by experts</li>
  <li>Security</li>
</ul>

<h3 id="technology">Technology</h3>

<p><strong>thin client:</strong> designed to be especially small so that the bulk of computation occurs on the server</p>

<p><strong>thick client:</strong> designed to host the bulk of computation so that there is no need for continuous server communication</p>

<p>Clouds have created a shift towards thin clients, since servers can be hosted on clouds.</p>

<p><strong>data centers:</strong> large capacity computation warehouses which are globally distributed</p>

<p>Clouds have created APIs for:</p>

<ul>
  <li>Administration</li>
  <li>Development</li>
  <li>Resource migration</li>
</ul>

<p><strong>virtualization:</strong> decoupling physical and computing resources. Kinds:</p>

<ul>
  <li>Emulation: VM simulates partial hardware e.g. QEMU</li>
  <li>Paravirtualization: Software interface to VM e.g. Xen</li>
  <li>Full: Complete simulation of hardware e.g. VMWare</li>
</ul>

<p>Network virtualization can be created through using VPNs.</p>

<h3 id="layers-of-control">Layers of Control</h3>

<p>Software as a Service (SaaS)</p>

<ul>
  <li>Example: Google Docs, a collaborative document editor</li>
  <li>vendor controlled remote applications</li>
  <li>concerns: control, performance, security, privacy</li>
</ul>

<p>Platform as a Service (PaaS)</p>

<ul>
  <li>Example: Google App Engine, a deployment management service for applications</li>
  <li>vendor controlled environment</li>
  <li>concerns: SaaS ones, limited choice in technology on platform</li>
</ul>

<p>Infrastructure as a Service (IaaS)</p>

<ul>
  <li>Example: Amazon EC2, a hardware service for applications</li>
  <li>vendor provided resources; consumer provisions VM</li>
  <li>concerns: SaaS ones, more expertise needed to leverage flexibility</li>
</ul>

<p><img src="img47.png" alt="img47" /></p>

<p><strong>serverless computing:</strong> cloud provider acts as the server, i.e. consumer does not create a server on the cloud</p>

<p>Function as a Service (FaaS)</p>

<ul>
  <li>Consumers define a function to be run on a cloud provided server rather than writing a server to be deployed as in PaaS</li>
</ul>

<h3 id="cloud-security-non-functional-properties">Cloud Security Non-Functional Properties</h3>

<ul>
  <li>Confidentiality (keep unauthorized users out)</li>
  <li>Integrity (data was not altered)</li>
  <li>Authenticity (data modifications belong to the correct users)</li>
  <li>Anonymity (users of the service are anonymous to the cloud provider)</li>
  <li>Privacy (user data is properly controlled)</li>
</ul>

<p>The last 2 are a concern with regards to data remanence, since you have to be able to ensure that the cloud is purged of data.</p>

<h3 id="representational-state-transfer-rest">Representational State Transfer (REST)</h3>

<p>Client/server model where servers don’t maintain session state, and clients communicate using a uniform server interface e.g. URI endpoints and a payload.  You can version URIs and test REST using the endpoints.</p>

<p>REST Operations:</p>

<ul>
  <li>GET: list items</li>
  <li>PUT: replace items</li>
  <li>POST: append to items</li>
  <li>DELETE: delete items</li>
</ul>

<p>REST is used in many web frameworks.</p>

<p><strong>web service:</strong> software functionality offered over the web</p>

<p><strong>Web Services Description Language (WSDL):</strong> XML format describing the functionality of a web service</p>

<p><strong>Simple Object Access Protocol (SOAP):</strong> XML message protocol used to call web services</p>

<p><strong>microservices:</strong> architecture that structures an application as a collection of loosely coupled services</p>

<h1 id="checker-framework-1">Checker Framework 1</h1>

<p>Pluggable type checking:</p>

<ol>
  <li>Design a type system to solve a problem</li>
  <li>Write type qualifiers in code e.g. <code class="language-plaintext highlighter-rouge">@Immutable</code> or use type inference</li>
  <li>Type checker warns about violations at compile time</li>
</ol>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example 1</span>
<span class="nd">@Immutable</span> <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
<span class="n">date</span><span class="o">.</span><span class="na">setSecond</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// Immutable error</span>

<span class="c1">// Example 2</span>
<span class="nc">String</span> <span class="nf">op</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">Data</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="s">"transform: "</span> <span class="o">+</span> <span class="n">in</span><span class="o">.</span><span class="na">getF</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="img48.png" alt="img48" /></p>

<p>Static type system, plugs into compiler</p>

<p>Static type systems pluggable into the compiler don’t impact method binding, memory consumption, or execution.</p>

<p>Benefits of type systems:</p>

<ul>
  <li>Finds bugs in programs, gives guarantees
    <ul>
      <li>No bugs of some type e.g. no null dereferences</li>
      <li>No wrong annotations</li>
      <li>Limitations: you have to compile all of your program with CF, without suppressing warnings, CF has false positives and is unsound in places</li>
    </ul>
  </li>
  <li>Improves documentation</li>
  <li>Aids compilers, optimizers and analysis tools (e.g. can reduce the number of runtime checks)</li>
  <li>Type checking is familiar to programmers
    <ul>
      <li>Annotations are not too verbose, easier to do than formal verification</li>
    </ul>
  </li>
</ul>

<p>Cons of type systems:</p>

<ul>
  <li>Must use types into source (use type inference)</li>
  <li>False positives are possible (can be suppressed)</li>
</ul>

<p>The Checker Framework is a framework for pluggable type checkers that plugs into the OpenJDK or OracleJDK compiler. It integrates into build tools like Maven, Ant, and Gradle, as well as IDEs like Eclipse, IntelliJ and NetBeans.</p>

<p><img src="img49.png" alt="img49" /></p>

<p>Example type systems, with their corresponding annotations:</p>

<ul>
  <li>
    <p>Error types</p>

    <ul>
      <li>
        <p>Null dereferences, @NonNull</p>
      </li>
      <li>
        <p>Equality tests, @Interned (variable refers to the canonical representation of the object, only 1 copy of the variable’s value is stored)</p>

        <p>This allows safe comparisons with the <code class="language-plaintext highlighter-rouge">==</code> operator. Compare with @InternedDistinct variables which are not <code class="language-plaintext highlighter-rouge">equals()</code> to any other value.</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Interned</span> <span class="nc">String</span> <span class="n">i</span> <span class="o">=</span> <span class="s">"22"</span><span class="o">;</span>
<span class="c1">// i is not @InternedDistinct because i.equals(s) is true.</span>
<span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Integer</span><span class="o">(</span><span class="mi">22</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Concurrency/locking, @GuardedBy</p>
      </li>
      <li>
        <p>Fake enumerations/typedefs, @Fenum</p>
      </li>
    </ul>
  </li>
  <li>
    <p>String types</p>

    <ul>
      <li>Regular expression syntax, @Regex</li>
      <li>printf format strings, @Format</li>
      <li>Method signature format, @FullyQualified</li>
      <li>Compiler messages, @CompilerMessageKey</li>
    </ul>
  </li>
  <li>
    <p>Security types</p>

    <ul>
      <li>Command line injection vulnerabilities, @OsTrusted</li>
      <li>Information flow privacy, @Source</li>
    </ul>
  </li>
</ul>

<h1 id="checker-framework-2">Checker Framework 2</h1>

<p>Java 5 defines declaration annotations such as @Deprecated, which apply to a class, method, or field but do not apply to the method’s return type or the field’s type.</p>

<p>Java 8 defines type annotations.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Java 8 annotations</span>
<span class="nd">@Interned</span> <span class="nc">String</span> <span class="nf">intern</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>               <span class="c1">// return value</span>
<span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">String</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>    <span class="c1">// parameter</span>
<span class="nc">String</span> <span class="nf">toString</span><span class="o">(</span><span class="nd">@Tainted</span> <span class="nc">MyClass</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>  <span class="c1">// receiver ("this" parameter)</span>
<span class="nd">@NonNull</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nd">@Interned</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">;</span>       <span class="c1">// generics:  non-null list of interned Strings</span>
<span class="nd">@Interned</span> <span class="nc">String</span> <span class="nd">@NonNull</span> <span class="o">[]</span> <span class="n">messages</span><span class="o">;</span>          <span class="c1">// arrays:  non-null array of interned Strings</span>
<span class="n">myDate</span> <span class="o">=</span> <span class="o">(</span><span class="nd">@Initialized</span> <span class="nc">Date</span><span class="o">)</span> <span class="n">beingConstructed</span><span class="o">;</span>  <span class="c1">// cast</span>
</code></pre></div></div>

<p>When using external libraries, you need the library to be annotated correctly in order to use the Checker Framework. If the library distribution has been annotated already, the Checker Framework can look up the annotations automatically. Otherwise, you can annotate the library yourself manually or you can supply CF with a specification stub file.</p>

<p>Checker Framework provides:</p>

<ul>
  <li>
    <p>Generics (type polymorphism), subclasses must respect superclass annotations (this is not enabled by default)</p>
  </li>
  <li>
    <p>Full type systems</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This means that the Regex annotation class is a subtype of UnknownRegex annotation class</span>
<span class="nd">@SubtypeOf</span><span class="o">(</span><span class="nc">UnknownRegex</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Regex</span> <span class="o">{}</span>
  
<span class="c1">// You can get checker specific errors</span>
<span class="kt">void</span> <span class="nf">visitSynchronized</span><span class="o">(</span><span class="nc">SynchronizedTree</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">ExpressionTree</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getExpression</span><span class="o">();</span>
	<span class="nc">AnnotatedTypeMirror</span> <span class="n">type</span> <span class="o">=</span> <span class="n">getAnnotatedType</span><span class="o">(</span><span class="n">expr</span><span class="o">);</span>
	<span class="k">if</span><span class="o">(!</span><span class="n">type</span><span class="o">.</span><span class="na">hasAnnotation</span><span class="o">(</span><span class="no">NONNULL</span><span class="o">))</span> <span class="o">{</span>
		<span class="n">checker</span><span class="o">.</span><span class="na">report</span><span class="o">(</span><span class="nc">Result</span><span class="o">.</span><span class="na">failure</span><span class="o">(...),</span> <span class="n">expr</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Qualifier polymorphism (e.g. @PolyNull)</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Cast returns null if and only if the argument is null</span>
<span class="nd">@PolyNull</span> <span class="no">T</span> <span class="nf">max</span><span class="o">(</span><span class="nd">@PolyNull</span> <span class="no">T</span> <span class="n">x</span><span class="o">,</span> <span class="no">T</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  
<span class="c1">// Equivalent to this, which is not legal Java</span>
<span class="nd">@NonNull</span> <span class="no">T</span> <span class="nf">max</span><span class="o">(</span> <span class="nd">@NonNull</span> <span class="no">T</span> <span class="n">x</span><span class="o">,</span>  <span class="nd">@NonNull</span> <span class="no">T</span> <span class="n">y</span><span class="o">);</span>
<span class="nd">@Nullable</span> <span class="no">T</span> <span class="nf">max</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="no">T</span> <span class="n">x</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="no">T</span> <span class="n">y</span><span class="o">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Qualifier defaults: what qualifiers are used when no annotation is provided</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Fields defaulted to @Nullable instead of @NonNull</span>
<span class="nd">@DefaultQualifier</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">Nullable</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">locations</span> <span class="o">=</span> <span class="nc">TypeUseLocation</span><span class="o">.</span><span class="na">FIELD</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>
    <span class="nc">Object</span> <span class="n">nullableField</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nd">@NonNull</span> <span class="nc">Object</span> <span class="n">nonNullField</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// Not pictured: </span>
<span class="c1">// enum values, string literals, and method receivers are always non null</span>
<span class="c1">// string literals and enum values are always interned</span>
</code></pre></div>    </div>

    <p>Compare with implicit annotations, which are default annotations for a specified type. This is an example of a type introduction rule, since we introduce a type based on some rule.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Denotes that the literal "null" always has the type qualified @Nullable</span>
<span class="nd">@ImplicitFor</span><span class="o">(</span><span class="n">literals</span> <span class="o">=</span> <span class="o">{</span> <span class="nc">LiteralKind</span><span class="o">.</span><span class="na">NULL</span> <span class="o">}</span> 
							<span class="n">typeNames</span> <span class="o">=</span> <span class="o">{</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Void</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE_USE</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE_PARAMETER</span><span class="o">});</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Nullable</span> <span class="o">{}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Pre/postconditions</p>
  </li>
  <li>
    <p>Warning suppression</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// might return null</span>
<span class="nd">@Nullable</span> <span class="nc">Object</span> <span class="nf">getObject</span><span class="o">(...)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  
<span class="kt">void</span> <span class="nf">myMethod</span><span class="o">()</span> <span class="o">{</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"nullness"</span><span class="o">)</span> <span class="c1">// with argument x, getObject always returns a non-null value</span>
<span class="nd">@NonNull</span> <span class="nc">Object</span> <span class="n">o2</span> <span class="o">=</span> <span class="n">getObject</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="dataflow-framework">DataFlow Framework</h2>

<p>CF performs flow-sensitive type refinement using dataflow analysis, CF decides the most precise type of expressions.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// It's more general but also correct to say here that s is String</span>
<span class="kt">void</span> <span class="nf">m3</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nd">@NonNull</span> <span class="nc">String</span> <span class="n">nn</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">String</span> <span class="n">nble</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span> <span class="c1">// s has type @Nullable String</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">nn</span><span class="o">;</span>
        <span class="o">...</span> <span class="c1">// s has type @NonNull String</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">nble</span><span class="o">;</span>
        <span class="o">...</span> <span class="c1">// s has type @Nullable String again</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="nd">@Nullable</span> <span class="nc">String</span> <span class="n">s</span><span class="o">;</span>
	<span class="c1">// s is a @Nullable</span>
	<span class="k">if</span><span class="o">(</span><span class="n">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// s is a @NonNull</span>
		<span class="o">...</span>
	<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
		<span class="o">...</span>
	<span class="o">}</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The aim is to write a runtime check or operation that helps DataFlow refine types.</p>

<p>Steps to use DataFlow</p>

<ol>
  <li>
    <p>Create required classes and configure them to be used</p>

    <ol>
      <li>Create a subclass extending CFAbstractTransfer</li>
      <li>Configure CF to use the subclass</li>
    </ol>
  </li>
  <li>
    <p>Override methods that handle Nodes of interest</p>

    <ol>
      <li>Override visit method in subclass to handle an AST node (e.g. EqualToNode, LeftShiftNode, VariableDeclarationNode) of interest</li>
    </ol>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Vistor method to override for method invocation</span>
<span class="kd">public</span> <span class="nc">TransferResult</span><span class="o">&lt;</span><span class="nc">CFValue</span><span class="o">,</span> <span class="nc">CFStore</span><span class="o">&gt;</span> <span class="nf">visitMethodInvocation</span><span class="o">(</span>
   <span class="nc">MethodInvocationNode</span> <span class="n">n</span><span class="o">,</span> <span class="nc">TransferInput</span><span class="o">&lt;</span><span class="nc">CFValue</span><span class="o">,</span> <span class="nc">CFStore</span><span class="o">&gt;</span> <span class="n">in</span><span class="o">)</span>  <span class="o">{</span> <span class="err">…</span> <span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Determine which expressions will be refined</p>

    <p>Say for example you’re trying to refine op(a, b). You can either update the result type op(a, b) by returning some specific TransferResult from your visit method, or you can update the CFStore of a or b in order to refine their types. Updates automatically persist for the rest of the scope.</p>
  </li>
  <li>
    <p>Implement the refinement</p>

    <ol>
      <li>
        <p>Check that you have the correct visited node. For example, visitMethodInvocation is called for ever method invocation, but you likely only want to refine for a specific method e.g. RegexUtils.asRegex</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="o">(</span><span class="nc">ElementUtils</span><span class="o">.</span><span class="na">matchesElement</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="no">IS_REGEX_METHOD_NAME</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Determine what the refinement type should be e.g. RegexUtils.asRegex(“(some)</td>
              <td> </td>
              <td>(regex)”, 2) should refine to Regex type with 2 groups, or @Regex{2}</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Return a TransferResult with the refined types and/or modify the CF store</li>
    </ol>
  </li>
</ol>

<p>CF uses jtreg, which is a lightweight regression test harness used by OpenJDK. It has tests that look like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Expected error is written as comment</span>
<span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"%+s%"</span><span class="o">;</span>
<span class="c1">//:: error: (format.string.invalid)</span>
<span class="n">f</span><span class="o">.</span><span class="na">format</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="s">"illegal"</span><span class="o">);</span>
</code></pre></div></div>

<h1 id="code-quality-and-programming-languages">Code Quality and Programming Languages</h1>

<p>Bug finders:</p>

<ul>
  <li>C linters</li>
  <li>FindBugs</li>
  <li>CheckStyle</li>
  <li>PMD</li>
  <li>Google Error Prone: type checking system</li>
</ul>

<p>Optional/Gradual Type Systems:</p>

<ul>
  <li>TypeScript (typed programming language that compiles to JavaScript, also can do type inference)</li>
  <li>Flow (static type checker for JavaScript, uses static type annotations and type inference)</li>
  <li>Python 3 (object types such as <code class="language-plaintext highlighter-rouge">int</code> are built in to interpreter)</li>
</ul>

<p>Newer type systems with option type or none type built in (i.e. <code class="language-plaintext highlighter-rouge">int?</code> in Swift)</p>

<ul>
  <li>Scala</li>
  <li>Kotlin</li>
  <li>F#</li>
  <li>Swift</li>
  <li>Julia</li>
  <li>Reason</li>
</ul>

<p>Concurrency safety can be built into programming languages:</p>

<ul>
  <li>Erlang</li>
  <li>Go</li>
  <li>Rust</li>
  <li>Pony</li>
</ul>

<h1 id="optional-type-systems">Optional Type Systems</h1>

<p>Generics enable types to be parameters when defining classes, interfaces, and methods.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"hello"</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>   <span class="c1">// no cast</span>
</code></pre></div></div>

<p>You can restrict the types that can be used as the generic by subclassing the generic using extends. Your generic can extend multiple types.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Box</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">t</span><span class="o">;</span>          

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
		
		<span class="c1">// Can also do U extends A, B, Comparable&lt;U&gt;</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">U</span> <span class="kd">extends</span> <span class="nc">Number</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">inspect</span><span class="o">(</span><span class="no">U</span> <span class="n">u</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"T: "</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"U: "</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Box</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">integerBox</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Box</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>
        <span class="n">integerBox</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="nc">Integer</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
        <span class="n">integerBox</span><span class="o">.</span><span class="na">inspect</span><span class="o">(</span><span class="s">"some text"</span><span class="o">);</span> <span class="c1">// error: this is still String!</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Consider using T as Apple, which is a subclass of Fruit.</p>

<p><strong>covariance:</strong> If a generic interface only has methods that return objects of type T, but don’t consume objects of type T e.g. Iterable<T>, Iterator<T></T></T></p>

<p>We should be able to use Iterable<Apple> as Iterable<Fruit>, since we can't change Iterable<Fruit> to contain anything but Apples.</Fruit></Fruit></Apple></p>

<p>You should be able to use a Child as a Parent.</p>

<p><strong>contravariance:</strong> If a generic interface has methods that consume objects of type T but don’t return objects of type T e.g. Comparable<T></T></p>

<p>We should be able to use Comparable<Fruit> as a  Comparable<Apple>.</Apple></Fruit></p>

<p>You should be able to use a Parent as a Child.</p>

<p><strong>invariant:</strong> If a generic interface has methods that both return and consume objects of type T e.g. List<T>, Set<T></T></T></p>

<p>We cannot use a List<Apple> as a List<Fruit> because we can add an Orange to the List<Fruit> and make the original List<Apple> inconsistent.</Apple></Fruit></Fruit></Apple></p>

<h2 id="use-site-variance">Use site variance</h2>

<p>Java doesn’t allow generics to have covariance or contravariance by default. You can express it using <strong>wildcards</strong> like &lt;? extends A&gt; and &lt;? super B&gt;.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Covariance</span>
<span class="nc">Producer</span><span class="o">&lt;</span><span class="no">B</span><span class="o">&gt;</span> <span class="n">producerOfB</span> <span class="o">=</span> <span class="cm">/*...*/</span><span class="o">;</span>
<span class="c1">// Annotation ? extends A is at the USE SITE</span>
<span class="c1">// ? extends A is a Parent, B is a Child</span>
<span class="nc">Producer</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">A</span><span class="o">&gt;</span> <span class="n">producerOfA</span> <span class="o">=</span> <span class="n">producerOfB</span><span class="o">;</span> <span class="c1">// legal</span>
<span class="no">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">producerOfA</span><span class="o">.</span><span class="na">produce</span><span class="o">();</span>
<span class="c1">// producerOfB = producerOfA; // still illegal</span>
 
<span class="c1">// Contravariance</span>
<span class="nc">Consumer</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="n">consumerOfA</span> <span class="o">=</span> <span class="cm">/*...*/</span><span class="o">;</span>
<span class="c1">// ? super B is a Child, A is a Parent</span>
<span class="nc">Consumer</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">B</span><span class="o">&gt;</span> <span class="n">consumerOfB</span> <span class="o">=</span> <span class="n">consumerOfA</span><span class="o">;</span> <span class="c1">// legal</span>
<span class="n">consumerOfB</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="k">new</span> <span class="no">B</span><span class="o">());</span>
<span class="c1">// consumerOfA = consumerOfB; // still illegal</span>
</code></pre></div></div>

<h2 id="declaration-site-variance">Declaration site variance</h2>

<p>Kotlin uses declaration site variance.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Producer = object you only read from</span>
<span class="kd">interface</span> <span class="nc">IProducer</span><span class="o">&lt;</span><span class="n">out</span> <span class="no">T</span><span class="o">&gt;</span> <span class="c1">// Covariant</span>
<span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="c1">// Consumer = object you only write to</span>
<span class="kd">interface</span> <span class="nc">IConsumer</span><span class="o">&lt;</span><span class="n">in</span> <span class="no">T</span><span class="o">&gt;</span> <span class="c1">// Contravariant</span>
<span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
 
<span class="n">val</span> <span class="nl">producerOfB:</span> <span class="nc">IProducer</span><span class="o">&lt;</span><span class="no">B</span><span class="o">&gt;</span> <span class="o">=</span> <span class="cm">/*...*/</span><span class="o">;</span>
<span class="n">val</span> <span class="nl">producerOfA:</span> <span class="nc">IProducer</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">producerOfB</span><span class="o">;</span>  <span class="c1">// now legal</span>
<span class="c1">// producerOfB = producerOfA;  // still illegal</span>
 
<span class="n">val</span> <span class="nl">consumerOfA:</span> <span class="nc">IConsumer</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="cm">/*...*/</span><span class="o">;</span>
<span class="n">val</span> <span class="nl">consumerOfB:</span> <span class="nc">IConsumer</span><span class="o">&lt;</span><span class="no">B</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">consumerOfA</span><span class="o">;</span>  <span class="c1">// now legal</span>
<span class="c1">// consumerOfA = consumerOfB;  // still illegal</span>
</code></pre></div></div>

<p>Using a generic that extends multiple types in Kotlin is expressed using the <code class="language-plaintext highlighter-rouge">where</code> clause.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fun</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">copyWhenGreater</span><span class="o">(</span><span class="nl">list:</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;,</span> <span class="nl">threshold:</span> <span class="no">T</span><span class="o">):</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span>
    <span class="n">where</span> <span class="no">T</span> <span class="o">:</span> <span class="nc">CharSequence</span><span class="o">,</span>
          <span class="no">T</span> <span class="o">:</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">filter</span> <span class="o">{</span> <span class="n">it</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="o">}.</span><span class="na">map</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="nullness-in-the-checker-framework">Nullness in the Checker Framework</h1>

<p>Due to side effects in methods, it’s tough to know if something’s null or not after you’ve called a method. We can use annotations to help.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="o">(</span><span class="n">myField</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">method1</span><span class="o">();</span>
	<span class="c1">// Is myField null now?</span>
	<span class="n">myField</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// 3 ways to ensure non-null</span>
<span class="nd">@SideEffectFree</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>  
<span class="nd">@MonotonicNonNull</span> <span class="n">myField</span><span class="o">;</span> 
<span class="nd">@EnsuresNonNull</span><span class="o">(</span><span class="err">“</span><span class="n">myField</span><span class="err">”</span><span class="o">)</span> <span class="n">method1</span><span class="o">()</span> <span class="o">{...}</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@SideEffectFree</td>
      <td>Doesn’t modify external state</td>
    </tr>
    <tr>
      <td>@Deterministic</td>
      <td>Same args gives same result</td>
    </tr>
    <tr>
      <td>@Pure</td>
      <td>@Deterministic and @SideEffectFree</td>
    </tr>
    <tr>
      <td>@MonotonicNonNull</td>
      <td>Null or non-null value that can only be reassigned to a non-null value</td>
    </tr>
    <tr>
      <td>@RequiresNonNull</td>
      <td>Precondition on method requiring non-null on some specified parameter</td>
    </tr>
    <tr>
      <td>@EnsuresNonNull</td>
      <td>Postcondition on method ensuring non-null on some specified parameter</td>
    </tr>
    <tr>
      <td>@Initialized</td>
      <td>Constructor has completed</td>
    </tr>
    <tr>
      <td>@UnderInitialization</td>
      <td>Constructor currently executing</td>
    </tr>
    <tr>
      <td>@UnknownInitialization</td>
      <td>Might be initialized or under intialization</td>
    </tr>
    <tr>
      <td>@KeyFor(String [] keys)</td>
      <td>Each of keys is a key in the given maps</td>
    </tr>
    <tr>
      <td>@SuppressWarnings(“warning”)</td>
      <td>Suppress warning</td>
    </tr>
  </tbody>
</table>

<p>Java 8 introduced Optional<T> type. If you use optionals in a bad way, i.e. using  `Optional.get()` when you don't know whether or not it's present, you should be punished with a compiler error. We can implement some of those errors using type systems in CF.</T></p>

<p>Define @MaybePresent and @Present, @Present is a @SubtypeOf(@MaybePresent).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Enforces never using Optional.get() unless Optional is present</span>
<span class="kd">class</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="c1">// When a method is called, this is implicitly passed</span>
	<span class="no">T</span> <span class="nf">get</span><span class="o">(</span><span class="nd">@Present</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
	<span class="no">T</span> <span class="nf">orElseThrow</span><span class="o">(</span><span class="nd">@Present</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="k">this</span><span class="o">,</span> <span class="o">...)</span> <span class="o">{...}</span>
	<span class="nd">@Present</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="no">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{...}</span>
	<span class="nc">Optional</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">ofNullable</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="no">T</span> <span class="n">value</span><span class="o">){...}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can also use Dataflow to create a runtime test like <code class="language-plaintext highlighter-rouge">x.isPresent()</code> in order to refine types.</p>
</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2018-12-10T00:00:00+00:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe"><div class="subscribe"><i class="fas fa-rss"></i> <a type="application/rss+xml" href="/notes/feed.xml">Subscribe</a></div>
</div><div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/notes/2018/11/19/se-464-architecture-assignment.html">SE 464 Architecture Assignment - LLVM</a></div><div class="next"><span>NEXT</span><a href="/notes/2018/12/16/cs-343.html">CS 343</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ivy Zhou"><meta itemprop="url" content="/notes/"><meta itemprop="description" content="an uneasy soul"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Follow me on Medium.">
        <a class="button button--circle medium-button" itemprop="sameAs" href="https://medium.com/@ivyzhou" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M834.7 279.8l61.3-58.9V208H683.7L532.4 586.4 360.3 208H137.7v12.9l71.6 86.6c7 6.4 10.6 15.8 9.7 25.2V673c2.2 12.3-1.7 24.8-10.3 33.7L128 805v12.7h228.6v-12.9l-80.6-98a39.99 39.99 0 0 1-11.1-33.7V378.7l200.7 439.2h23.3l172.6-439.2v349.9c0 9.2 0 11.1-6 17.2l-62.1 60.3V819h301.2v-12.9l-59.9-58.9c-5.2-4-7.9-10.7-6.8-17.2V297a18.1 18.1 0 0 1 6.8-17.2z"></path>
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/zhouivy" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/ivy-zhou" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Sentences 2020,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script>
<script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

